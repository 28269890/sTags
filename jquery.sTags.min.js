/*
	jQuery 标签插件 	ver 0.1

	https://github.com/28269890/sTags
*/
(function(c){c.fn.sTags=function(m){var a=c.extend({},c.fn.sTags.defaults,m),g=Date.now()+""+Math.ceil(1E3*Math.random()),h=c(this);if(3==a.dataAttr.length)for(var d in a.data)a.data[d].id||(a.data[d].id=a.data[d][a.dataAttr[0]]),a.data[d].name||(a.data[d].name=a.data[d][a.dataAttr[1]]),a.data[d].screen||(a.data[d].screen=a.data[d][a.dataAttr[2]]);""==a.tagName&&(a.tagName="div");m=c("\x3cdiv/\x3e",{class:a.tagInputCSS,"tag-id":g});var q=c("\x3cdiv/\x3e",{class:a.tagListCSS,"tag-list-id":g}),n=function(d){a.screen&&c("\x3cinput\x3e",a.screenInput).keyup(function(){var b=c(this).val().replace(/[^a-zA-Z]/g,"");""==b?c(d+"\x3e"+a.tagName+"[screen]").show():(c(d+"\x3e"+a.tagName+"[screen]").hide(),c(d+"\x3e"+a.tagName+"[screen^\x3d'"+b+"']").show())}).appendTo(d);var b=0,k=0,l="";if(0<a.data.length)for(var e in a.data){var f={},g;for(g in a.tagAttr)f[g]=a.tagAttr[g].replace("{name}",a.data[e].name).replace("{id}",a.data[e].id);f.tagid=a.data[e].id;a.screen&&(f.screen=a.data[e].screen);1==a.color&&a.data[e].screen&&(""==l?(l=a.data[e].screen.substr(0,1),b=a.colorData[k]):l!=a.data[e].screen.substr(0,1)&&(k++,k==a.colorData.length&&(k=0),l=a.data[e].screen.substr(0,1),b=a.colorData[k]),f.style="background:"+b[0]+";color:"+b[1]);2==a.color&&(b=a.colorData[Math.floor(Math.random()*a.colorData.length)],f.style="background:"+b[0]+";color:"+b[1]);f=c("\x3c"+a.tagName+"/\x3e",f);a.tagHtml?f.html(a.tagHtml.replace("{name}",a.data[e].name).replace("{id}",a.data[e].id)):f.html("\x3cspan\x3e"+a.data[e].name+"\x3c/span\x3e");f.data("fn",a.data[e].fn);f.click(function(){"DIV"==h.prop("tagName")&&("function"==typeof c(this).data("fn")?c(this).data("fn")(c(this)):a.click(c(this)));"INPUT"==h.prop("tagName")&&r(c(this))});f.appendTo(d)}for(e in a.data_)f={},1==a.color&&(k++,k==a.colorData.length&&(k=0),b=a.colorData[k],f.style="background:"+b[0]+";color:"+b[1]),2==a.color&&(b=a.colorData[Math.floor(Math.random()*a.colorData.length)],f.style="background:"+b[0]+";color:"+b[1]),b=c("\x3cdiv/\x3e",f).html(a.data_[e].name).data("fn",a.data_[e].fn).click(function(){"function"==typeof c(this).data("fn")&&c(this).data("fn")(c(this))}),a.data_[e].position?b.prependTo(d):b.appendTo(d);c(d).prepend(a.tagTXT)};if("DIV"==c(this).prop("tagName")){c(this).attr("tag-list-id",g).addClass(a.tagListCSS);var p=[];if(Array.isArray(a.defaultData)){if(0<a.data.length)for(d in a.data)-1<a.defaultData.indexOf(Number(a.data[d].id))&&p.push(a.data[d]);a.data=p}n("[tag-list-id\x3d"+g+"]")}if("INPUT"==c(this).prop("tagName")){c(this).hide();c(this).after(q);c(this).after(m);var r=function(d){var b=h.val(),b=""==b?[]:b.split(","),b=b.map(Number);if(-1<b.indexOf(Number(d.attr("tagid"))))return!1;b.push(d.attr("tagid"));h.val(b.join(","));b=c("\x3ca\x3ex\x3c/a\x3e").click(function(){var a=c(this).parent(),b=h.val(),d=new RegExp("([^d]?)"+a.attr("tagid")+"([^d]?)","g"),b=b.replace(/[^\d,]/).replace(d,"$1$2").replace(/,,/,",").replace(/^,/,"").replace(/,$/,"");h.val(b);a.remove()});b=c("\x3cdiv\x3e\x3cspan\x3e"+d.text()+"\x3c/span\x3e\x3c/div\x3e").attr("tagid",d.attr("tagid")).append(b);Array.isArray(a.defaultData)?-1<a.defaultData.indexOf(Number(d.attr("tagid")))?b.attr("class",a.tagCSS[0]):b.attr("class",a.tagCSS[1]):b.attr("class",a.tagCSS[1]);b.appendTo("[tag-id\x3d"+g+"]")};n("[tag-list-id\x3d"+g+"]");h.val()&&(a.defaultData=h.val().split(","),h.val(""));Array.isArray(a.defaultData)&&(a.defaultData=a.defaultData.map(Number));for(d in a.defaultData)c("[tag-list-id\x3d"+g+"]\x3e[tagid\x3d"+a.defaultData[d]+"]").click()}};c.fn.sTags.defaults={data:[],data_:[],dataAttr:[],tagInputCSS:"sTags-input",tagListCSS:"sTags",tagCSS:["sTags-old","sTags-new"],color:1,colorData:[["#90c5f0","#fff"],["#8E388E","#fff"],["#FFA500","#fff"],["#FBF","#fff"],["#DA70D6","#fff"],["#A2CD5A","#fff"],["#228B22","#fff"],["#CDC0B0","#fff"],["#CD7054","#fff"],["#00688B","#fff"]],screen:!0,screenInput:{type:"text",size:8,placeholder:"\u7b5b\u9009"},tagTXT:"Tags:",click:function(c){console.log(c.attr("tagid"))},tagName:"",tagHtml:"",tagAttr:{}}})(jQuery);