/*
		jQuery 标签插件

ver 0.1

可应用于input和div标签

应用于input标签：将对input标签的数据进行修改

应用于div标签：实现tag标签列表的点击事件



配置文件说明
	data:标签数据：数组 --必填项
		格式例子：[{id:1,name:"sdd",screen:"sdd"},{id:2,name:"ggf",screen:"ggf"}]
		--div标签，当作用于div标签时，还可对每个标签添加单独的点击事件
		{
			id:1,
			name:"sdd",
			screen:"sdd",
			fn:function(e){//e为点击元素自身
				console.log(e.tagid)
			}
		}

	data_:附加标签数据，该数据将会显示在标签列表最后，以标签形式显示，作为单纯的按钮功能，不受标签、筛选和tagid限制。
		[
			{
				name:"",//标签名
				position:0,//插入位置：0最后插入，非零最前插入
				fn:function(){ //点击事件
					console.log("button1 event")
				}
			}
		]

	dataAttr：数据值添加：数组
		原有数据可能不会适应本插件，这里是为了补全本插件所用的数据
		如原有数据可能是，{index:1,title:"标题一",pinyin:"bt1"}
		那么为了能够让本插件正确使用这些数据，dataAttr的属性就应该填写["index","title","pinyin"]
		注意，要按照顺序填写
		index对应id
		title对应name
		pinyind对应screen

	defaultData:默认标签：数组 
		存放标签数据中的id的值
		当input标签中有数据是会替换本数值并转为数组
		数据例子：[1,2,3]
		--input标签
			当作用于input标签时，将会将默认值的标签填入标签编辑框
		--div标签
			当作用于div标签时，将不再显示所有标签而改为仅显示默认标签
	
	tagInputCSS:标签编辑框CSS样式：字符串  -- input标签有效
		默认值：sTags-input
	
	tagListCSS:待选标签列表CSS样式：字符串 
		默认值：sTags

	tagCSS:标签编辑框内的标签的CSS样式：数组  -- input标签有效
		默认值：["sTags-old","sTags-new"]
		数据0表示 defaultData（默认标签数据的样式）
		数据1表示 本次编辑新增加的标签的样式
	
	screen：标签列表筛选功能是否启用:bool值
		默认值：true
		该功能针对标签数据的screen，如果关闭该功能则忽略screen的数据。

	screenInput：筛选输入框属性：json
		默认值:{
					type:"text",
					size:8,
					placeholder:"筛选"
				}

	tagTXT：标签列表的前缀字符：字符串

	click:标签列表的点击事件 -- 当标签应用于div时有效  -- div标签有效
		例子：click:function(e){
			console.log(e.attr("gatid"),e.text())
		}

	color:标签列表颜色开关：数字
			--0:关闭
			--1:按screen首字符切换colorData内容
				要使用该功能，请将标签数据按照screen排序
				该功能要开启screen才有效
			--2:随机使用colorData内容
	colorData:要应用的标签列表的颜色数据：二维数组
			olorData[x][0]:标签背景色
			olorData[x][1]:标签字色







默认 样式表
<style type="text/css">
	.sTags-input{
		border: 1px solid #ccc;
		height: 100px;
	}
	.sTags-input>div{
		display: inline-block;
		padding: 5px 5px 5px 12px;
		margin: 2px;
		border-radius: 2px;

	}
	.sTags-input>div>a{
		display: inline-block;
		margin: 0 7px;
		color: #ddd;
		cursor: pointer;

	}
	.sTags{
		margin: 10px 0;
	}
	.sTags-old{
		color: #fff;
		background: #A2A;
	}
	.sTags-new{
		color: #fff;
		background: #A2CD5A;
	}
	.sTags>a,
	.sTags>div{
		cursor: pointer;
		display: inline-block;
		padding: 5px 12px;
		margin: 2px;
		border-radius: 2px;
		color: #fff;
		background: #A2CD5A;
	}
</style>
*/
(function(c){c.fn.sTags=function(m){var a=c.extend({},c.fn.sTags.defaults,m),g=Date.now()+""+Math.ceil(1E3*Math.random()),h=c(this);if(3==a.dataAttr.length)for(var d in a.data)a.data[d].id||(a.data[d].id=a.data[d][a.dataAttr[0]]),a.data[d].name||(a.data[d].name=a.data[d][a.dataAttr[1]]),a.data[d].screen||(a.data[d].screen=a.data[d][a.dataAttr[2]]);""==a.tagName&&(a.tagName="div");m=c("\x3cdiv/\x3e",{class:a.tagInputCSS,"tag-id":g});var q=c("\x3cdiv/\x3e",{class:a.tagListCSS,"tag-list-id":g}),n=function(d){a.screen&&c("\x3cinput\x3e",a.screenInput).keyup(function(){var b=c(this).val().replace(/[^a-zA-Z]/g,"");""==b?c(d+"\x3e"+a.tagName+"[screen]").show():(c(d+"\x3e"+a.tagName+"[screen]").hide(),c(d+"\x3e"+a.tagName+"[screen^\x3d'"+b+"']").show())}).appendTo(d);var b=0,k=0,l="";if(0<a.data.length)for(var e in a.data){var f={},g;for(g in a.tagAttr)f[g]=a.tagAttr[g].replace("{name}",a.data[e].name).replace("{id}",a.data[e].id);f.tagid=a.data[e].id;a.screen&&(f.screen=a.data[e].screen);1==a.color&&a.data[e].screen&&(""==l?(l=a.data[e].screen.substr(0,1),b=a.colorData[k]):l!=a.data[e].screen.substr(0,1)&&(k++,k==a.colorData.length&&(k=0),l=a.data[e].screen.substr(0,1),b=a.colorData[k]),f.style="background:"+b[0]+";color:"+b[1]);2==a.color&&(b=a.colorData[Math.floor(Math.random()*a.colorData.length)],f.style="background:"+b[0]+";color:"+b[1]);f=c("\x3c"+a.tagName+"/\x3e",f);a.tagHtml?f.html(a.tagHtml.replace("{name}",a.data[e].name).replace("{id}",a.data[e].id)):f.html("\x3cspan\x3e"+a.data[e].name+"\x3c/span\x3e");f.data("fn",a.data[e].fn);f.click(function(){"DIV"==h.prop("tagName")&&("function"==typeof c(this).data("fn")?c(this).data("fn")(c(this)):a.click(c(this)));"INPUT"==h.prop("tagName")&&r(c(this))});f.appendTo(d)}for(e in a.data_)f={},1==a.color&&(k++,k==a.colorData.length&&(k=0),b=a.colorData[k],f.style="background:"+b[0]+";color:"+b[1]),2==a.color&&(b=a.colorData[Math.floor(Math.random()*a.colorData.length)],f.style="background:"+b[0]+";color:"+b[1]),b=c("\x3cdiv/\x3e",f).html(a.data_[e].name).data("fn",a.data_[e].fn).click(function(){"function"==typeof c(this).data("fn")&&c(this).data("fn")(c(this))}),a.data_[e].position?b.prependTo(d):b.appendTo(d);c(d).prepend(a.tagTXT)};if("DIV"==c(this).prop("tagName")){c(this).attr("tag-list-id",g).addClass(a.tagListCSS);var p=[];if(Array.isArray(a.defaultData)){if(0<a.data.length)for(d in a.data)-1<a.defaultData.indexOf(Number(a.data[d].id))&&p.push(a.data[d]);a.data=p}n("[tag-list-id\x3d"+g+"]")}if("INPUT"==c(this).prop("tagName")){c(this).hide();c(this).after(q);c(this).after(m);var r=function(d){var b=h.val(),b=""==b?[]:b.split(","),b=b.map(Number);if(-1<b.indexOf(Number(d.attr("tagid"))))return!1;b.push(d.attr("tagid"));h.val(b.join(","));b=c("\x3ca\x3ex\x3c/a\x3e").click(function(){var a=c(this).parent(),b=h.val(),d=new RegExp("([^d]?)"+a.attr("tagid")+"([^d]?)","g"),b=b.replace(/[^\d,]/).replace(d,"$1$2").replace(/,,/,",").replace(/^,/,"").replace(/,$/,"");h.val(b);a.remove()});b=c("\x3cdiv\x3e\x3cspan\x3e"+d.text()+"\x3c/span\x3e\x3c/div\x3e").attr("tagid",d.attr("tagid")).append(b);Array.isArray(a.defaultData)?-1<a.defaultData.indexOf(Number(d.attr("tagid")))?b.attr("class",a.tagCSS[0]):b.attr("class",a.tagCSS[1]):b.attr("class",a.tagCSS[1]);b.appendTo("[tag-id\x3d"+g+"]")};n("[tag-list-id\x3d"+g+"]");h.val()&&(a.defaultData=h.val().split(","),h.val(""));Array.isArray(a.defaultData)&&(a.defaultData=a.defaultData.map(Number));for(d in a.defaultData)c("[tag-list-id\x3d"+g+"]\x3e[tagid\x3d"+a.defaultData[d]+"]").click()}};c.fn.sTags.defaults={data:[],data_:[],dataAttr:[],tagInputCSS:"sTags-input",tagListCSS:"sTags",tagCSS:["sTags-old","sTags-new"],color:1,colorData:[["#90c5f0","#fff"],["#8E388E","#fff"],["#FFA500","#fff"],["#FBF","#fff"],["#DA70D6","#fff"],["#A2CD5A","#fff"],["#228B22","#fff"],["#CDC0B0","#fff"],["#CD7054","#fff"],["#00688B","#fff"]],screen:!0,screenInput:{type:"text",size:8,placeholder:"\u7b5b\u9009"},tagTXT:"Tags:",click:function(c){console.log(c.attr("tagid"))},tagName:"",tagHtml:"",tagAttr:{}}})(jQuery);