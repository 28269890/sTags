/*
	jQuery 标签插件 	ver 0.2

	https://github.com/28269890/sTags

	Demo:https://28269890.github.io/sTags/
*/
(function(d){d.fn.sTagsCtrl=function(a){function e(){k.html("");b.screen&&d("\x3cinput\x3e",b.screenInput).keyup(function(){var a=d(this).val().replace(/[^a-zA-Z]/g,"");""==a?k.children(b.tagName+"[screen]").show():(k.children(b.tagName+"[screen]").hide(),k.children(b.tagName+"[screen^\x3d'"+a+"']").show())}).appendTo(k);if(0<b.data.length)for(var a in b.data){var c={},e;for(e in b.tagAttr)c[e]=b.tagAttr[e].replace("{name}",b.data[a].name).replace("{id}",b.data[a].id);c.tagid=b.data[a].id;b.screen&&(c.screen=b.data[a].screen);1==b.color&&b.data[a].screen&&(""==p?(p=b.data[a].screen.substr(0,1),h=b.colorData[l]):p!=b.data[a].screen.substr(0,1)&&(l++,l==b.colorData.length&&(l=0),p=b.data[a].screen.substr(0,1),h=b.colorData[l]),c.style="background:"+h[0]+";color:"+h[1]);2==b.color&&(h=b.colorData[Math.floor(Math.random()*b.colorData.length)],c.style="background:"+h[0]+";color:"+h[1]);c=d("\x3c"+b.tagName+"/\x3e",c);b.tagHtml?c.html(b.tagHtml.replace("{name}",b.data[a].name).replace("{id}",b.data[a].id)):c.html("\x3cspan\x3e"+b.data[a].name+"\x3c/span\x3e");c.data("fn",b.data[a].fn);c.click(function(){"DIV"==f.prop("tagName")&&("function"==typeof d(this).data("fn")&&d(this).data("fn")(d(this)),"function"==typeof b.click&&b.click(d(this)));"INPUT"==f.prop("tagName")&&m(d(this))});c.appendTo(k)}for(a in b.data_)c={},1==b.color&&(l++,l==b.colorData.length&&(l=0),h=b.colorData[l],c.style="background:"+h[0]+";color:"+h[1]),2==b.color&&(h=b.colorData[Math.floor(Math.random()*b.colorData.length)],c.style="background:"+h[0]+";color:"+h[1]),e=d("\x3cdiv/\x3e",c).html(b.data_[a].name).data("fn",b.data_[a].fn).click(function(){"function"==typeof d(this).data("fn")&&d(this).data("fn")(d(this))}),b.data_[a].position?e.prependTo(k):e.appendTo(k)}function m(a){var c=Number(a.attr("tagid"));if(-1<b.defaultData.indexOf(c))return!1;b.defaultData.push(c);-1==b.defaultVal.indexOf(c)&&b.addVal.push(c);q(b.removeVal,c);f.val(b.defaultData.join(","));c=d("\x3ca\x3ex\x3c/a\x3e").click(function(){var a=d(this).parent(),c=Number(a.attr("tagid"));q(b.defaultData,c);-1<b.defaultVal.indexOf(c)&&b.removeVal.push(c);q(b.addVal,c);f.val(b.defaultData.join(","));a.remove()});c=d("\x3cdiv\x3e\x3cspan\x3e"+a.text()+"\x3c/span\x3e\x3c/div\x3e").attr("tagid",a.attr("tagid")).append(c);Array.isArray(b.defaultVal)?-1<b.defaultVal.indexOf(Number(a.attr("tagid")))?c.attr("class",b.tagCSS[0]):c.attr("class",b.tagCSS[1]):c.attr("class",b.tagCSS[1]);c.appendTo("[tag-id\x3d"+n+"]")}function g(){"INPUT"==f.prop("tagName")&&(r.remove(),k.remove(),f.show(),console.log(0));"DIV"==f.prop("tagName")&&(f.html(""),f.removeClass(b.tagListCSS))}var f=d(this),n=f.attr("tagid");if(void 0!==n){var b=f.data("sTagsSetOptions"),r=d("[tag-id\x3d"+n+"]"),k=d("[tag-list-id\x3d"+n+"]"),h=0,l=0,p="",q=function(a,b){for(var c=0;c<a.length;c++)a[a.length-c-1]==b&&a.splice(a.length-c-1,1)};"ShowList"==a&&e();"destroy"==a&&g();"reload"==a&&(g(),f.sTags(),e())}};d.fn.sTags=function(a){var e=d(this);if(void 0===e.attr("tagid")){a=d.extend({},d.fn.sTags.defaults,a);var m=Date.now()+""+Math.ceil(1E3*Math.random());a.addVal=[];a.defaultVal=[];a.removeVal=[];e.attr("tagid",m);e.data("sTagsSetOptions",a)}else a=e.data("sTagsSetOptions"),m=e.attr("tagid");if(3==a.dataAttr.length)for(var g in a.data)a.data[g].id||(a.data[g].id=a.data[g][a.dataAttr[0]]),a.data[g].name||(a.data[g].name=a.data[g][a.dataAttr[1]]),a.data[g].screen||(a.data[g].screen=a.data[g][a.dataAttr[2]]);a.tagName||(a.tagName="div");if("DIV"==e.prop("tagName")){e.attr("tag-list-id",m).addClass(a.tagListCSS);var f=[];if(Array.isArray(a.defaultData)){if(0<a.data.length)for(g in a.data)-1<a.defaultData.indexOf(Number(a.data[g].id))&&f.push(a.data[g]);a.data=f}e.sTagsCtrl("ShowList")}if("INPUT"==e.prop("tagName")){var f=d("\x3cdiv/\x3e",{class:a.tagInputCSS,"tag-id":m}),n=d("\x3cdiv/\x3e",{class:a.tagListCSS,"tag-list-id":m});e.hide();e.after(n);e.after(f);e.sTagsCtrl("ShowList");f=[];Array.isArray(a.defaultData)&&(f=a.defaultData);e.val()&&(f=e.val().split(","),e.val(""));f=f.map(Number);a.defaultVal=f;a.defaultData=[];for(g in f)isNaN(f[g])||d("[tag-list-id\x3d"+m+"]\x3e[tagid\x3d"+f[g]+"]").click()}};d.fn.sTags.defaults={data:[],data_:[],dataAttr:[],tagInputCSS:"sTags-input",tagListCSS:"sTags",tagCSS:["sTags-old","sTags-new"],color:1,colorData:[["#90c5f0","#fff"],["#8E388E","#fff"],["#FFA500","#fff"],["#FBF","#fff"],["#DA70D6","#fff"],["#A2CD5A","#fff"],["#228B22","#fff"],["#CDC0B0","#fff"],["#CD7054","#fff"],["#00688B","#fff"]],screen:!0,screenInput:{type:"text",size:8,placeholder:"\u7b5b\u9009"},tagTXT:"Tags:",click:function(a){console.log(a.attr("tagid"))},tagName:"",tagHtml:"",tagAttr:{}}})(jQuery);