/*
	jQuery 标签插件 	ver 0.2

	https://github.com/28269890/sTags

	Demo:https://28269890.github.io/sTags/
*/
(function(e){e.fn.sTagsCtrl=function(d){function h(){m.html("");a.screen&&e("\x3cinput\x3e",a.screenInput).keyup(function(){var b=g.val().replace(/[^a-zA-Z]/g,"");""==b?m.children(a.tagName+"[screen]").show():(m.children(a.tagName+"[screen]").hide(),m.children(a.tagName+"[screen^\x3d'"+b+"']").show())}).appendTo(m);if(0<a.data.length)for(var k in a.data){var c={},d;for(d in a.tagAttr)c[d]=a.tagAttr[d].replace("{name}",a.data[k].name).replace("{id}",a.data[k].id);c.tagid=a.data[k].id;a.screen&&(c.screen=a.data[k].screen);1==a.color&&a.data[k].screen&&(""==p?(p=a.data[k].screen.substr(0,1),l=a.colorData[n]):p!=a.data[k].screen.substr(0,1)&&(n++,n==a.colorData.length&&(n=0),p=a.data[k].screen.substr(0,1),l=a.colorData[n]),c.style="background:"+l[0]+";color:"+l[1]);2==a.color&&(l=a.colorData[Math.floor(Math.random()*a.colorData.length)],c.style="background:"+l[0]+";color:"+l[1]);c=e("\x3c"+a.tagName+"/\x3e",c);a.tagHtml?c.html(a.tagHtml.replace("{name}",a.data[k].name).replace("{id}",a.data[k].id)):c.html("\x3cspan\x3e"+a.data[k].name+"\x3c/span\x3e");c.data("fn",a.data[k].fn);c.click(function(){"DIV"==g.prop("tagName")&&("function"==typeof e(this).data("fn")&&e(this).data("fn")(e(this)),"function"==typeof a.click&&a.click(e(this)));"INPUT"==g.prop("tagName")&&b(e(this))});c.appendTo(m)}for(k in a.data_)c={},1==a.color&&(n++,n==a.colorData.length&&(n=0),l=a.colorData[n],c.style="background:"+l[0]+";color:"+l[1]),2==a.color&&(l=a.colorData[Math.floor(Math.random()*a.colorData.length)],c.style="background:"+l[0]+";color:"+l[1]),d=e("\x3cdiv/\x3e",c).html(a.data_[k].name).data("fn",a.data_[k].fn).click(function(){"function"==typeof e(this).data("fn")&&e(this).data("fn")(e(this))}),a.data_[k].position?d.prependTo(m):d.appendTo(m)}function b(b){var c=Number(b.attr("tagid"));if(-1<a.defaultData.indexOf(c))return!1;a.defaultData.push(c);-1==a.defaultVal.indexOf(c)&&a.addVal.push(c);q(a.removeVal,c);g.val(a.defaultData.join(","));c=e("\x3ca\x3ex\x3c/a\x3e").click(function(){var b=e(this).parent(),c=Number(b.attr("tagid"));q(a.defaultData,c);-1<a.defaultVal.indexOf(c)&&a.removeVal.push(c);q(a.addVal,c);g.val(a.defaultData.join(","));b.remove()});c=e("\x3cdiv\x3e\x3cspan\x3e"+b.text()+"\x3c/span\x3e\x3c/div\x3e").attr("tagid",b.attr("tagid")).append(c);Array.isArray(a.defaultVal)?-1<a.defaultVal.indexOf(Number(b.attr("tagid")))?c.attr("class",a.tagCSS[0]):c.attr("class",a.tagCSS[1]):c.attr("class",a.tagCSS[1]);c.appendTo("[tag-id\x3d"+f+"]")}var g=e(this),f=g.attr("tagid");if(void 0!==f){var a=g.data("sTipsSetOptions"),r=e("[tag-id\x3d"+f+"]"),m=e("[tag-list-id\x3d"+f+"]"),l=0,n=0,p="",q=function(a,b){for(var c=0;c<a.length;c++)a[a.length-c-1]==b&&a.splice(a.length-c-1,1)};"ShowList"==d&&h();"destroy"==d&&("Input"==g.prop("tagName")&&(r.remove(),m.remove(),g.show()),"DIV"==g.prop("tagName")&&(g.html(""),g.removeClass(a.tagListCSS)))}};e.fn.sTags=function(d){var h=e(this);if(void 0===h.attr("tagid")){var b=e.extend({},e.fn.sTags.defaults,d),g=Date.now()+""+Math.ceil(1E3*Math.random());b.addVal=[];b.defaultVal=[];b.removeVal=[];h.attr("tagid",g);h.data("sTipsSetOptions",b)}if(3==b.dataAttr.length)for(var f in b.data)b.data[f].id||(b.data[f].id=b.data[f][b.dataAttr[0]]),b.data[f].name||(b.data[f].name=b.data[f][b.dataAttr[1]]),b.data[f].screen||(b.data[f].screen=b.data[f][b.dataAttr[2]]);b.tagName||(b.tagName="div");if("DIV"==h.prop("tagName")){h.attr("tag-list-id",g).addClass(b.tagListCSS);d=[];if(Array.isArray(b.defaultData)){if(0<b.data.length)for(f in b.data)-1<b.defaultData.indexOf(Number(b.data[f].id))&&d.push(b.data[f]);b.data=d}h.sTagsCtrl("ShowList")}if("INPUT"==h.prop("tagName")){d=e("\x3cdiv/\x3e",{class:b.tagInputCSS,"tag-id":g});var a=e("\x3cdiv/\x3e",{class:b.tagListCSS,"tag-list-id":g});h.hide();h.after(a);h.after(d);h.sTagsCtrl("ShowList");d=[];Array.isArray(b.defaultData)&&(d=b.defaultData);h.val()&&(d=h.val().split(","),h.val(""));d=d.map(Number);b.defaultVal=d;b.defaultData=[];for(f in d)isNaN(d[f])||e("[tag-list-id\x3d"+g+"]\x3e[tagid\x3d"+d[f]+"]").click()}};e.fn.sTags.defaults={data:[],data_:[],dataAttr:[],tagInputCSS:"sTags-input",tagListCSS:"sTags",tagCSS:["sTags-old","sTags-new"],color:1,colorData:[["#90c5f0","#fff"],["#8E388E","#fff"],["#FFA500","#fff"],["#FBF","#fff"],["#DA70D6","#fff"],["#A2CD5A","#fff"],["#228B22","#fff"],["#CDC0B0","#fff"],["#CD7054","#fff"],["#00688B","#fff"]],screen:!0,screenInput:{type:"text",size:8,placeholder:"\u7b5b\u9009"},tagTXT:"Tags:",click:function(d){console.log(d.attr("tagid"))},tagName:"",tagHtml:"",tagAttr:{}}})(jQuery);